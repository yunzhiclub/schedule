!function(){"use strict";angular.module("mdr.select2",[]).directive("mdrSelect2",[function(){return{restrict:"E",controller:"mdrSelect2Ctrl",scope:{url:"@",src:"=",options:"@",model:"=",selected:"=",allowClear:"@",placeholder:"@",disabled:"=",required:"="},template:'<select class="form-control select2" id="selectId_{{$id}}" ng-options="{{options}}" ng-model="model" ng-disabled="disabled" ng-required="required"><option></option></select>'}}]).controller("mdrSelect2Ctrl",["$scope","$element","$attrs","mdrSelect2Service",function(e,t,l,o){function c(){setTimeout(function(){$("#selectId_"+e.$id).select2({placeholder:e.placeholder,allowClear:e.allowClear})},0)}function n(t){setTimeout(function(){$("#selectId_"+e.$id).select2({placeholder:t})},0)}function i(t){if(void 0!==t){var l=r();angular.forEach(e[l.collection],function(o,c){return t==o[l.track]?(e.model=o,setTimeout(function(){$("#selectId_"+e.$id).val(t).trigger("change")},0),!1):void 0})}}function r(){var t=e.options.split(" "),l=t.indexOf("in"),o=t.indexOf("track"),c=t[o+2].split("."),n={collection:t[l+1],track:c[1]};return n}e.placeholder="Select",e.allowClear=!1,c(),e.$watch("url",function(t,l){if(void 0!==t){var d=t.substr(-1);if("/"!==d){var s=r();e[s.collection]=[],n("Loading..."),o.find(t).then(function(t){t.length<=0||void 0===t.length?n("No results found"):(e[s.collection]=t,c(),i(e.selected))})["catch"](function(e){n("No results found")})}}}),e.$watchCollection("src",function(t,l){if(void 0!==t){var o=r();e[o.collection]=t,c(),i(e.selected)}}),e.$watch("model",function(t,l){(void 0===t||null===t)&&(e.model={},setTimeout(function(){$("#selectId_"+e.$id).val("").trigger("change.select2")},0))}),e.$watch("selected",function(e,t){i(e)})}]).factory("mdrSelect2Service",["$http","$q",function(e,t){return{find:function(l){var o=t.defer();return e.get(l).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}}])}();